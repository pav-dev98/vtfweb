---
// obtener la fecha actual en formato yyyy-mm-dd
let today = new Date();
let formattedToday = today.toISOString().split('T')[0];
// obtener el primer dia de este mes
let firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
let formattedFirstDay = firstDay.toISOString().split('T')[0];


---

<div class="rounded-2xl text-gray-400">
  <form
  id="form"
  class="flex flex-col gap-4"
  action="/api/submit"
  method="POST"
>
  <div class="flex justify-between gap-4 items-center">
    <input
      type="text"
      id="name"
      name="name"
      required
      class="border rounded-md px-2 py-1 w-full placeholder-gray-200"
      placeholder="Nombre"
    />
  </div>
  <div class="flex justify-between gap-4 items-center">
    <!-- <label for="email">Email:</label> -->
    <input
      type="email"
      id="email"
      name="email"
      required
      class="border rounded-md px-2 py-1  w-full placeholder-gray-200"
      placeholder="Email"
    />
  </div>
  <div class="flex justify-between gap-4 items-center">
    <!-- <label for="request_type">Tipo de peticion:</label> -->
    <input
      type="tel"
      id="request_type"
      name="request_type"
      required
      class="border rounded-md px-2 py-1  w-full placeholder-gray-200"
      placeholder="Tipo de peticion"
    />
  </div>
  <div class="flex justify-between gap-4 items-center">
    <!-- <label for="request_reason">Motivo de pedido:</label> -->
    <input
      type="tel"
      id="request_reason"
      name="request_reason"
      required
      class="border rounded-md px-2 py-1  w-full placeholder-gray-200"
      placeholder="Motivo de pedido"
    />
  </div>

  <!-- <div class="flex justify-between gap-4 items-center">
    <label for="request_type">Tipo de peticion:</label>
    <input
      type="tel"
      id="request_type"
      name="request_type"
      required
      class="border rounded-md px-2 py-1  w-full"
      placeholder="Tipo de peticion"
    />
  </div> -->
  <!-- <div class="flex justify-between gap-4 items-center">
    <label for="request_date">Fecha de peticion:</label>
    <input
      type="date"
      id="request_date"
      name="request_date"
      required
      class="border rounded-md p-1"
    />
  </div> -->
  <div class="flex justify-between gap-4 items-center">
    <label for="visitor_count"># de visitantes:</label>
    <input
      type="number"
      id="visitor_count"
      name="visitor_count"
      required
      class="border rounded-md p-1"
      
    />
  </div>
  <div class="flex justify-between gap-4 items-center">
    <!-- <label for="event_type">Tipo de evento:</label> -->
    <input
      type="text"
      id="event_type"
      name="event_type"
      required
      class="border rounded-md px-2 py-1  w-full placeholder-gray-200"
      placeholder="Tipo de evento"
    />
  </div>
  <!-- <div class="flex justify-between gap-4 items-center">
    <label for="title">Titulo:</label>
    <input
      type="text"
      id="title"
      name="title"
      required
      class="border rounded-md p-1 w-full"
      placeholder="Titulo"
    />
  </div> -->
  <div class="flex flex-col gap-4">
    <p class="text-right">
      <label for="start">Dia de inicio:</label>
    </p>
    <div class="flex justify-end gap-4">
      <input
      type="date"
      id="start"
      name="start"
      required
      class="border rounded-md p-1 "
      min={formattedFirstDay}
      value={formattedToday}
    />
    <input
      type="time"
      id="hourStart"
      name="hourStart"
      class="border rounded-md p-1"
      min="08:00"
      max="14:00"
      value="09:00"
      required
    />
    </div>
  </div>
  
  <div class="flex flex-col gap-4">
    <p class="text-right">
      <label for="end">Dia final</label>
    </p>
    <div class="flex justify-end gap-2">
      <input
      type="date"
      id="end"
      name="end"
      required
      class="border rounded-md p-1 "
      min={formattedFirstDay}
      value={formattedToday}
    />
    <input
      type="time"
      id="hourEnd"
      name="hourEnd"
      required
      class="border rounded-md p-1"
      min="08:00"
      max="14:00"
      value="09:00"
    />
    </div>
  </div>
  
  <button
    type="submit"
    class="bg-blue-500 text-white py-2 rounded-md mt-8 uppercase"
  >
    Reservar Visita
  </button>
</form>
</div>
<script>
    let form = document.getElementById('form') as HTMLFormElement;
    let flag = form instanceof HTMLFormElement;
    if (!flag) {
        console.error('Form not found');
    }
    else{
      
      form?.addEventListener('submit', async (e) => {
        e.preventDefault();
        let formData = new FormData(form);
        let datos = Object.fromEntries(formData);
        let response = await fetch('/api/submit', {
        method: 'POST',
        body: JSON.stringify(datos),
        });
        let result = await response.json();
        console.log(result);
        if (result.status === 200) {
          alert('Cita registrada con exito');
          form.reset();
        } else {
          alert('Error al registrar la cita');
        }
      });
    }
</script>